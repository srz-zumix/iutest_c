language: cpp

compiler:
  - clang
  - gcc
 
before_install:
  - sudo easy_install cpp-coveralls

install:
  # gcc 4.8
  - sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
  - sudo apt-get -qq update
  - if [ "${CXX}" = 'g++' ]; then sudo apt-get -qq install g++-4.8; fi
  - if [ "${CXX}" = 'g++' ]; then sudo update-alternatives --install /usr/bin/gcc  gcc  /usr/bin/gcc-4.8 90; fi
  - if [ "${CXX}" = 'g++' ]; then sudo update-alternatives --install /usr/bin/g++  g++  /usr/bin/g++-4.8 90; fi
  - if [ "${CXX}" = 'g++' ]; then sudo update-alternatives --install /usr/bin/gcov gcov /usr/bin/gcov-4.8 90;  fi

script:
  - cd ./test
  - make all
  - if [ "${USE_COVERAGE}" = '1' ]; then make encode-utf8; fi

after_success:
  # Coverage
  - if [ "${USE_COVERAGE}" = '1' ]; then make send-coverage; fi

env:
  matrix:
    - USE_COVERAGE=0
    - USE_COVERAGE=1

matrix:
  exclude:
    - compiler: clang
      env: USE_COVERAGE=1
